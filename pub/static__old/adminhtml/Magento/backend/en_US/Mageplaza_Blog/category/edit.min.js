define(['jquery','prototype'],function(jQuery){var categorySubmit=function(url,useAjax){var activeTab=$('active_tab_id');if(activeTab){if(activeTab.tabsJsObject&&activeTab.tabsJsObject.tabs('activeAnchor')){activeTab.value=activeTab.tabsJsObject.tabs('activeAnchor').prop('id');}}
var params={};var fields=$('category_edit_form').getElementsBySelector('input','select');for(var i=0;i<fields.length;i++){if(!fields[i].name){continue;}
params[fields[i].name]=fields[i].getValue();}
var categoryId=params['category[id]']?params['category[id]']:0;var isCreating=categoryId==0;var path=params['category[path]'].split('/');var parentId=path.pop();if(parentId==categoryId){parentId=path.pop();}
if(isCreating){if(!tree.currentNodeId){tree.currentNodeId=parentId;}
tree.addNodeTo=parentId;}
jQuery('#category_edit_form').trigger('submit');};return function(config,element){config=config||{};jQuery(element).on('click',function(event){categorySubmit(config.url,config.ajax);});};});